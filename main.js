/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, visit the plugin's github repository.
*/

"use strict";var F=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var j=(r,t)=>{for(var e in t)F(r,e,{get:t[e],enumerable:!0})},W=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of K(t))!q.call(r,s)&&s!==e&&F(r,s,{get:()=>t[s],enumerable:!(i=G(t,s))||i.enumerable});return r};var X=r=>W(F({},"__esModule",{value:!0}),r);var Y={};j(Y,{default:()=>L});module.exports=X(Y);var x=require("obsidian");var n=require("obsidian");var z={["openrouter"]:[{apiName:"openai/gpt-4o-mini",displayName:"GPT 4o Mini",provider:"openrouter",maxTokens:2048},{apiName:"openai/gpt-4o",displayName:"GPT-4o",provider:"openrouter",maxTokens:2048}],["lmstudio"]:[]},O={getModelsByProvider:r=>({["openrouter"]:[{apiName:"anthropic/claude-3.5-haiku",displayName:"Claude 3.5 Haiku",maxTokens:2048,provider:"openrouter"}],["lmstudio"]:[{apiName:"default",displayName:"Default Model",maxTokens:2048,provider:"lmstudio"}]})[r]||[]};var p=(e=>(e[e.OpenRouter="openrouter"]="OpenRouter",e[e.LMStudio="lmstudio"]="LMStudio",e))(p||{}),B={llm:{provider:p.OpenRouter,model:"anthropic/claude-3.5-haiku",temperature:.7,maxTokens:2048},paths:{templatesPath:"templates",outputPath:"",templateExtension:"md"},processing:{usePromptOptimization:!0,defaultPromptTemplate:`Please fill out this template based on the following requirements:

`,includeFrontmatter:!0,inheritTemplateTags:!0},showRibbonIcon:!0};var f=class extends n.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i,this.settings=i.settings}display(){let{containerEl:e}=this;e.empty(),e.addClass("filler-inner-settings"),this.addHeader(),this.addLLMSettings(),this.addPathSettings(),this.addProcessingSettings(),this.addGeneralSettings()}addHeader(){let e=this.containerEl.createEl("div",{cls:"settings-header"});e.createEl("h2",{text:"Filler Inner"}),e.createEl("p",{text:"Configure how your templates are processed and filled.",cls:"settings-description"})}addLLMSettings(){let e=this.containerEl.createEl("div",{cls:"settings-section"});e.createEl("h3",{text:"LLM Configuration",cls:"section-header"}),new n.Setting(e).setName("LLM Provider").setDesc("Select your preferred Language Model provider").addDropdown(i=>{i.addOption("openrouter","OpenRouter"),i.addOption("lmstudio","LMStudio"),i.setValue(this.settings.llm.provider).onChange(async s=>{this.settings.llm.provider=s;let a=O.getModelsByProvider(s)[0];this.settings.llm.model=(a==null?void 0:a.apiName)||"",await this.plugin.saveSettings(),this.display()})}),new n.Setting(e).setName("API Key").setDesc("Enter your API key for the selected provider").addText(i=>i.setPlaceholder("Enter API key").setValue(this.settings.llm.apiKey||"").onChange(async s=>{this.settings.llm.apiKey=s,await this.plugin.saveSettings()})).addExtraButton(i=>i.setIcon("help-circle").setTooltip("How to get an API key").onClick(()=>{window.open(this.getProviderApiKeyUrl())})),new n.Setting(e).setName("Model").setDesc("Select the specific model to use").addDropdown(i=>{O.getModelsByProvider(this.settings.llm.provider).forEach(a=>{i.addOption(a.apiName,a.displayName)}),i.setValue(this.settings.llm.model).onChange(async a=>{this.settings.llm.model=a,await this.plugin.saveSettings()})}),new n.Setting(e).setName("Temperature").setDesc("Adjust the creativity of the model (0 = more focused, 1 = more creative)").addSlider(i=>i.setLimits(0,1,.1).setValue(this.settings.llm.temperature).setDynamicTooltip().onChange(async s=>{this.settings.llm.temperature=s,await this.plugin.saveSettings()})),new n.Setting(e).setName("Max Tokens").setDesc("Maximum length of generated content").addSlider(i=>i.setLimits(100,4e3,100).setValue(this.settings.llm.maxTokens).setDynamicTooltip().onChange(async s=>{this.settings.llm.maxTokens=s,await this.plugin.saveSettings()}))}addPathSettings(){let e=this.containerEl.createEl("div",{cls:"settings-section"});e.createEl("h3",{text:"File Paths",cls:"section-header"}),new n.Setting(e).setName("Templates Folder").setDesc("Location of your template files").addText(i=>i.setPlaceholder("templates").setValue(this.settings.paths.templatesPath).onChange(async s=>{this.settings.paths.templatesPath=s,await this.plugin.saveSettings()})),new n.Setting(e).setName("Output Folder").setDesc("Where to save filled templates (leave empty for current folder)").addText(i=>i.setPlaceholder("Path for filled templates").setValue(this.settings.paths.outputPath).onChange(async s=>{this.settings.paths.outputPath=s,await this.plugin.saveSettings()}))}addProcessingSettings(){let e=this.containerEl.createEl("div",{cls:"settings-section"});e.createEl("h3",{text:"Processing Options",cls:"section-header"}),new n.Setting(e).setName("Prompt Optimization").setDesc("Automatically enhance prompts for better results").addToggle(i=>i.setValue(this.settings.processing.usePromptOptimization).onChange(async s=>{this.settings.processing.usePromptOptimization=s,await this.plugin.saveSettings()})),new n.Setting(e).setName("Default Prompt Template").setDesc("Template for structuring prompts").addTextArea(i=>i.setPlaceholder("Enter default prompt template").setValue(this.settings.processing.defaultPromptTemplate).onChange(async s=>{this.settings.processing.defaultPromptTemplate=s,await this.plugin.saveSettings()})),new n.Setting(e).setName("Include Frontmatter").setDesc("Keep frontmatter from template in filled version").addToggle(i=>i.setValue(this.settings.processing.includeFrontmatter).onChange(async s=>{this.settings.processing.includeFrontmatter=s,await this.plugin.saveSettings()})),new n.Setting(e).setName("Inherit Template Tags").setDesc("Copy tags from template to filled version").addToggle(i=>i.setValue(this.settings.processing.inheritTemplateTags).onChange(async s=>{this.settings.processing.inheritTemplateTags=s,await this.plugin.saveSettings()}))}addGeneralSettings(){let e=this.containerEl.createEl("div",{cls:"settings-section"});e.createEl("h3",{text:"General Settings",cls:"section-header"}),new n.Setting(e).setName("Show Ribbon Icon").setDesc("Display Filler Inner icon in the ribbon").addToggle(i=>i.setValue(this.settings.showRibbonIcon).onChange(async s=>{this.settings.showRibbonIcon=s,await this.plugin.saveSettings(),this.plugin.updateRibbonIcon()})),new n.Setting(e).setName("Command Hotkey").setDesc("Set a hotkey for quick access").addButton(i=>i.setButtonText(this.settings.defaultHotkey||"Not set").setClass("hotkey-button").onClick(()=>{this.app.setting.open("hotkeys")}))}getProviderApiKeyUrl(){return{[p.OpenRouter]:"https://openrouter.ai/account/api-keys",[p.LMStudio]:"https://lmstudio.example.com/account/api-keys"}[this.settings.llm.provider]||""}getProviderDisplayName(e){return{[p.OpenRouter]:"OpenRouter",[p.LMStudio]:"LMStudio"}[e]||e}};var l=require("obsidian");var T=class{constructor(t){this.templates=[];this.onSelectCallback=()=>{};this.container=t.createDiv({cls:"template-dropdown-container"}),this.initializeComponent()}mount(t){t.appendChild(this.container)}initializeComponent(){this.select=this.container.createEl("select",{cls:"template-select"}),this.select.addEventListener("change",()=>{let t=this.templates.find(e=>e.path===this.select.value);t&&this.onSelectCallback(t)})}setTemplates(t){this.templates=t,this.select.innerHTML="";let e=new Option("Select a template...","");e.disabled=!0,e.selected=!0,this.select.appendChild(e),t.forEach(i=>{let s=new Option(i.name,i.path);this.select.appendChild(s)})}onSelect(t){this.onSelectCallback=t}getValue(){return this.select.value}};function H(r,t){let e;return function(...i){let s=()=>{e=void 0,r(...i)};clearTimeout(e),e=window.setTimeout(s,t)}}var b=class{constructor(t){this.onChangeCallback=()=>{};this.onSubmitCallback=()=>{};this.container=t.createDiv({cls:"prompt-input-container"}),this.initializeComponent()}mount(t){t.appendChild(this.container)}initializeComponent(){let t=this.container.createDiv({cls:"input-wrapper"});this.createTextArea(t),this.createCharacterCount(t)}createTextArea(t){this.textarea=t.createEl("textarea",{cls:"prompt-textarea",attr:{placeholder:"Describe how you want the template filled...",rows:"1"}}),this.textarea.addEventListener("input",H(()=>{this.autoResize(),this.updateCharacterCount(),this.onChangeCallback(this.textarea.value)},100)),this.textarea.addEventListener("keydown",e=>{e.key==="Enter"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.onSubmitCallback())})}createCharacterCount(t){this.characterCount=t.createDiv({cls:"character-count"}),this.updateCharacterCount()}autoResize(){this.textarea.style.height="auto";let t=Math.min(this.textarea.scrollHeight,400);this.textarea.style.height=`${t}px`}updateCharacterCount(){let t=this.textarea.value.length;this.characterCount.textContent=`${t} characters`,this.characterCount.classList.toggle("warning",t>1e3),this.characterCount.classList.toggle("error",t>2e3)}getValue(){return this.textarea.value}setValue(t){this.textarea.value=t,this.autoResize(),this.updateCharacterCount()}onChange(t){this.onChangeCallback=t}onSubmit(t){this.onSubmitCallback=t}focus(){this.textarea.focus()}disable(){this.textarea.disabled=!0,this.container.addClass("disabled")}enable(){this.textarea.disabled=!1,this.container.removeClass("disabled")}};var P=class extends l.Modal{constructor(e,i,s,a,v){super(e);this.selectedTemplate=null;this.processingStatus="idle";this.intervalId=null;this.rippleTimeout=null;this.templateManager=i,this.llmService=s,this.promptOptimizer=a,this.fileService=v,this.modalEl.addClass("filler-inner-modal"),this.titleEl.addClass("filler-inner-title"),this.dropdown=new T(this.contentEl),this.promptInput=new b(this.contentEl)}onOpen(){let{contentEl:e}=this;e.empty(),this.titleEl.setText("\u2728 Fill Template"),new l.Setting(e).setName("Template").setDesc("Choose a template to fill").then(a=>{a.settingEl.addClass("template-setting"),this.dropdown.mount(a.controlEl)}),new l.Setting(e).setName("Requirements").setDesc("Describe how you want the template to be filled").then(a=>{a.settingEl.addClass("prompt-setting"),this.promptInput.mount(a.controlEl)});let i=e.createDiv("modal-footer");i.createEl("button",{text:"Cancel",cls:"cancel-button"}).addEventListener("click",()=>this.close()),this.submitButton=i.createEl("button",{text:"Generate",cls:"mod-cta submit-button"}),this.submitButton.addEventListener("click",this.handleSubmit.bind(this)),this.initializeEventListeners(),this.loadTemplates()}initializeEventListeners(){this.dropdown.onSelect(e=>{this.selectedTemplate=e,this.updateSubmitButtonState();let i=this.contentEl.querySelector(".template-select");i&&this.addRippleEffect(i)}),this.promptInput.onChange(e=>{this.updateSubmitButtonState()})}async handleSubmit(){if(this.processingStatus!=="processing"){if(!this.selectedTemplate){new l.Notice("\u{1F3AF} Please select a template first");return}if(!this.promptInput.getValue().trim()){new l.Notice("\u270D\uFE0F Please enter your requirements");return}try{this.processingStatus="processing",this.submitButton.empty();let e=this.submitButton.createSpan({cls:"loading-container"});e.createSpan({text:"Generating",cls:"loading-text"});let i=e.createSpan({cls:"loading-dots"});this.intervalId=window.setInterval(()=>{let a=i.textContent||"";i.textContent=a.length>=3?"":a+"."},500),this.submitButton.disabled=!0,this.addRippleEffect(this.submitButton);let s=await this.processTemplate();await this.fileService.createFilledFile(this.selectedTemplate,s),new l.Notice("\u2728 Template filled and saved successfully!"),this.close()}catch(e){console.error("\u{1F6A8} Template processing failed:",e),new l.Notice("\u274C Failed to generate the filled template. Check console for details.")}finally{this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null),this.processingStatus="idle",this.submitButton.empty(),this.submitButton.setText("Generate"),this.submitButton.disabled=!1}}}updateSubmitButtonState(){let e=!!this.selectedTemplate&&!!this.promptInput.getValue().trim();this.submitButton.toggleClass("ready",e),this.submitButton.disabled=!e}addRippleEffect(e){let i=e.createDiv("ripple"),s=e.getBoundingClientRect();i.style.left="50%",i.style.top="50%",setTimeout(()=>i.remove(),600)}async loadTemplates(){try{let e=await this.templateManager.getTemplates();this.dropdown.setTemplates(e)}catch(e){console.error("\u{1F4DA} Failed to load templates:",e),new l.Notice("\u274C Failed to load templates. Check console for details.")}}async processTemplate(){if(!this.selectedTemplate)throw new Error("No template selected.");let e=this.promptInput.getValue(),i=await this.templateManager.loadTemplate(this.selectedTemplate.path),s=await this.promptOptimizer.optimize(e,i),a=this.promptOptimizer.combine(i,s);return await this.llmService.generateFilledTemplate(i,a)}onClose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.rippleTimeout!==null&&(window.clearTimeout(this.rippleTimeout),this.rippleTimeout=null),this.contentEl.empty(),this.modalEl.removeClass("filler-inner-modal")}};var d=require("obsidian");function V(r){return r.extension==="md"&&r.path.startsWith("templates/")}var w=class{constructor(t,e){this.scanInterval=5e3;this.app=t,this.templatesPath=(0,d.normalizePath)(e),this.templateCache=new Map,this.lastScanTime=0}async getTemplate(t){await this.updateTemplatesCacheIfNeeded();let e=this.templateCache.get(t);if(!e)throw new Error("Template not found");return e}async loadTemplate(t){try{let e=await this.getTemplate(t),i=await this.app.vault.read(e.file);return this.validateTemplateContent(i)}catch(e){throw console.error("Failed to load template:",e),new Error("Invalid template content")}}async updateTemplatesCacheIfNeeded(){let t=Date.now();t-this.lastScanTime>this.scanInterval&&(await this.scanTemplates(),this.lastScanTime=t)}async scanTemplates(){try{let t=this.app.vault.getAbstractFileByPath(this.templatesPath);if(!(t instanceof d.TFolder)){console.warn("Templates folder not found:",this.templatesPath);return}let e=new Set;await this.scanFolder(t,e);for(let[i]of this.templateCache)e.has(i)||this.templateCache.delete(i)}catch(t){throw console.error("Failed to scan templates:",t),new Error("File system error")}}async scanFolder(t,e){for(let i of t.children)if(i instanceof d.TFile&&this.isValidTemplate(i)){let s=await this.createTemplate(i);e.add(s.path),this.templateCache.set(s.path,s)}else i instanceof d.TFolder&&await this.scanFolder(i,e)}isValidTemplate(t){return V(t)&&this.hasValidExtension(t)}hasValidExtension(t){return t.extension==="md"}async createTemplate(t){return{path:t.path,name:this.formatTemplateName(t.name),file:t,mtime:t.stat.mtime}}formatTemplateName(t){return t.replace(".md","").split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}validateTemplateContent(t){if(!t||t.trim().length===0)throw new Error("Invalid template content");return t}async getTemplateMetadata(t){let e=await this.getTemplate(t),i=this.app.metadataCache.getFileCache(e.file);return(i==null?void 0:i.frontmatter)||{}}async templateExists(t){return await this.updateTemplatesCacheIfNeeded(),this.templateCache.has(t)}async getTemplateModificationTime(t){return(await this.getTemplate(t)).mtime}setTemplatesPath(t){this.templatesPath=(0,d.normalizePath)(t),this.templateCache.clear(),this.lastScanTime=0}clearCache(){this.templateCache.clear(),this.lastScanTime=0}async getTemplates(){return await this.updateTemplatesCacheIfNeeded(),Array.from(this.templateCache.values())}};var S=class{};var U=require("obsidian");var A={APP_NAME:"The Filler Inner",REFERRER:"obsidian-filler-inner",API_VERSION:"1.0.0"};var y=class extends S{constructor(){super(...arguments);this.apiKey="";this.apiUrl="https://openrouter.ai/api/v1/chat/completions"}configure(e){this.apiKey=e.apiKey||"",this.apiUrl=e.apiUrl||this.apiUrl}async generateResponse(e,i){var c,R,m,N,k;if(!this.apiKey)throw new Error("OpenRouter API key is not configured.");let s=(c=i==null?void 0:i.temperature)!=null?c:.7,a=(R=i==null?void 0:i.maxTokens)!=null?R:1e3,v=(i==null?void 0:i.model)||"default-model",M={url:this.apiUrl,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","X-Referer":A.REFERRER||"","X-Title":A.APP_NAME||""},body:JSON.stringify({model:v,prompt:e,temperature:s,max_tokens:a,stream:!1})};try{let u=await(0,U.requestUrl)(M);if(u.status!==200)throw new Error(`OpenRouter API Error: ${u.status}`);let g=u.json;if(!g.choices||g.choices.length===0)throw new Error("No choices found in OpenRouter response.");let $=g.choices[0].text||"",_={input:((m=g.usage)==null?void 0:m.prompt_tokens)||0,output:((N=g.usage)==null?void 0:N.completion_tokens)||0,total:((k=g.usage)==null?void 0:k.total_tokens)||0};return{success:!0,data:$,tokens:_}}catch(u){return console.error("OpenRouter Adapter Error:",u),{success:!1,error:u.message||"Unknown error occurred.",tokens:{input:0,output:0,total:0}}}}async testConnection(){try{let e="Hello, this is a test prompt.",i=await this.generateResponse(e,{maxTokens:10});return i.success&&!!i.data}catch(e){return console.error("OpenRouter Adapter Test Connection Error:",e),!1}}getProviderType(){return"openrouter"}getAvailableModels(){return z["openrouter"].map(i=>i.apiName)}};var h=require("obsidian"),I=class{constructor(t){this.adapter=null;this.config=t,this.settings={processing:{usePromptOptimization:!1,defaultPromptTemplate:""}},this.initializeAdapter()}initializeAdapter(){let t=this.config.provider;switch(t){case p.OpenRouter:this.adapter=new y;break;case p.LMStudio:new h.Notice("LMStudio provider is not implemented yet."),this.adapter=null;break;default:new h.Notice(`Unsupported LLM Provider: ${t}`),this.adapter=null}this.adapter&&this.adapter.configure({apiKey:this.config.apiKey,apiUrl:this.config.apiUrl})}updateSettings(t){this.config=t,this.initializeAdapter()}async generateFilledTemplate(t,e){if(console.log("[LLMService.generateFilledTemplate] Input:",{templateContent:t,userPrompt:e}),!this.adapter)throw new Error("LLM Adapter is not initialized.");try{let i=`Here is a template to fill out:
---BEGIN TEMPLATE---
${t}
---END TEMPLATE---

Using these detailed instructions:
${e}

Please fill out the template above following these instructions. Preserve the template's structure and formatting while incorporating the details from the instructions.`;console.log("[LLMService.generateFilledTemplate] Sending prompt:",i);let s=await this.adapter.generateResponse(i,{temperature:this.config.temperature||.7,maxTokens:this.config.maxTokens||2048,model:this.config.model});if(!s.success||!s.data)throw new Error(s.error||"Failed to generate response");return String(s.data).trim()}catch(i){throw console.error("[LLMService.generateFilledTemplate] Generation error:",i),new Error(`Failed to generate content: ${i.message}`)}}async testConnection(){if(!this.adapter)return new h.Notice("LLM Adapter is not initialized."),!1;try{let t=await this.adapter.testConnection();return t?new h.Notice(`${this.adapter.getProviderType()} connection successful.`):new h.Notice(`${this.adapter.getProviderType()} connection failed.`),t}catch(t){return console.error("LLM Service Test Connection Error:",t),new h.Notice(`Error testing ${this.adapter.getProviderType()} connection: ${t.message}`),!1}}getAvailableModels(){return this.adapter?this.adapter.getAvailableModels?this.adapter.getAvailableModels():[]:[]}};var C=class{constructor(t,e){this.llmService=t,this.useOptimization=e}async optimize(t,e){if(console.log("[PromptOptimizer.optimize] Starting optimization with:",{useOptimization:this.useOptimization,hasLLMService:!!this.llmService,userPrompt:t,templateContent:typeof e}),!this.useOptimization||!this.llmService)return t;try{let i=await this.llmService.generateFilledTemplate(`Please optimize this prompt to be more specific and detailed: "${t}"`,"");return this.cleanResponse(i)}catch(i){return console.error("[PromptOptimizer.optimize] Error during optimization:",i),t}}cleanResponse(t){console.log("[PromptOptimizer.cleanResponse] Cleaning response:",t);let e=t.match(/"([^"]+)"/);if(e)return console.log("[PromptOptimizer.cleanResponse] Found quoted text:",e[1]),e[1].trim();let s=t.split(`
`)[0].replace(/^(Here's|This is|I've created|Here is).*?:/i,"").trim();return console.log("[PromptOptimizer.cleanResponse] Cleaned response:",s),s}combine(t,e){if(!t||!e)return t||e||"";try{let i=String(t).trim(),s=String(e).trim();return console.log("[PromptOptimizer.combine] Processing with:",{template:i.substring(0,100)+"...",prompt:s.substring(0,100)+"..."}),s}catch(i){return console.error("[PromptOptimizer.combine] Combination failed:",i),e}}};var o=require("obsidian"),E=class{constructor(t,e){this.app=t,this.outputPath=(0,o.normalizePath)(e.paths.outputPath),this.templateExtension=e.paths.templateExtension||"md"}async createFilledFile(t,e){let i=this.outputPath||this.app.vault.getRoot().path,s,a=this.app.vault.getAbstractFileByPath(i);if(a instanceof o.TFolder)s=a;else try{s=await this.app.vault.createFolder(i),new o.Notice(`Created output folder: ${i}`)}catch(m){throw console.error("Failed to create output folder:",m),new o.Notice("Failed to create output folder."),m}let v=new Date().toISOString().replace(/[:.]/g,"-"),M=`${t.name}-${v}.${this.templateExtension}`,c=`${s.path}/${M}`;if(this.app.vault.getAbstractFileByPath(c))throw new o.Notice(`File already exists: ${c}`),new Error(`File already exists: ${c}`);try{await this.app.vault.create(c,e),new o.Notice(`Filled template saved to ${c}`)}catch(m){throw console.error("Failed to create filled template file:",m),new o.Notice("Failed to save filled template."),m}}generateUniqueFileName(t){let e=new Date().toISOString().replace(/[:.]/g,"-");return`${t}-${e}.${this.templateExtension}`}async getOrCreateOutputFolder(){let t=this.outputPath||this.app.vault.getRoot().path,e,i=this.app.vault.getAbstractFileByPath(t);if(i instanceof o.TFolder)e=i;else try{e=await this.app.vault.createFolder(t),new o.Notice(`Created output folder: ${t}`)}catch(s){throw console.error("Failed to create output folder:",s),new o.Notice("Failed to create output folder."),s}return e}};var L=class extends x.Plugin{constructor(){super(...arguments);this.ribbonIcon=null}async onload(){console.log("Filler Inner: Loading plugin..."),await this.loadSettings(),this.initializeServices(),this.addSettingTab(new f(this.app,this)),this.settings.showRibbonIcon&&(this.ribbonIcon=this.addRibbonIcon("dice","Fill Template",()=>{this.openTemplateModal()}),this.ribbonIcon.addClass("filler-inner-ribbon-icon")),this.addCommand({id:"fill-template",name:"Fill Template",callback:()=>this.openTemplateModal()}),console.log("Filler Inner: Plugin loaded successfully.")}onunload(){console.log("Filler Inner: Unloading plugin..."),this.ribbonIcon&&(this.ribbonIcon.remove(),this.ribbonIcon=null),console.log("Filler Inner: Plugin unloaded successfully.")}async loadSettings(){this.settings=Object.assign({},B,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}initializeServices(){this.templateManager=new w(this.app,this.settings.paths.templatesPath),this.llmService=new I(this.settings.llm),this.promptOptimizer=new C(this.llmService,this.settings.processing.usePromptOptimization),this.fileService=new E(this.app,this.settings)}openTemplateModal(){if(!this.llmService){new x.Notice("LLM Service is not initialized.");return}new P(this.app,this.templateManager,this.llmService,this.promptOptimizer,this.fileService).open()}updateRibbonIcon(){this.settings.showRibbonIcon&&!this.ribbonIcon?(this.ribbonIcon=this.addRibbonIcon("dice","Fill Template",()=>{this.openTemplateModal()}),this.ribbonIcon.addClass("filler-inner-ribbon-icon")):!this.settings.showRibbonIcon&&this.ribbonIcon&&(this.ribbonIcon.remove(),this.ribbonIcon=null)}};
